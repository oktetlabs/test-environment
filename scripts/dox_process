#!/bin/bash
# SPDX-License-Identifier: Apache-2.0
# Copyright (C) 2016-2022 OKTET Labs Ltd. All rights reserved.

# This file generates list of all test packages in the sockapi group.  One
# day doxygen will allow to get list of group members automatically (except
# for modules page they offer right now).

DOXYGEN_OUT=doc/html/
PACKAGE_FILE=package.dox
SUITE_NAME=$1
SUITE_LOGO=$2

header() {
cat<<EOF
/**
<!-- DO NOT EDIT -- AUTOGENERATED FILE -->
@defgroup $SUITE_NAME $SUITE_LOGO
@{
EOF
}

header > $PACKAGE_FILE
body=""

for i in $(grep --files-with-matches "@ingroup.*$SUITE_NAME" */*.dox); do
    group_name=$(cat $i | grep "@defgroup" | sed "s/@defgroup\s*\(\S*\).*/\1/")

    echo "- @ref $group_name"
done | sort >> $PACKAGE_FILE

echo "@}" >> $PACKAGE_FILE
echo "*/" >> $PACKAGE_FILE
