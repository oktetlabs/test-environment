<html>
  <head>
    <TITLE>Log Filter Configuration</TITLE>
    <link rel="stylesheet" type="text/css" href="style.css">

<script>

function logsUpdate(cb_name, value)
{
    all_entities = window.opener.top.entities;
    var cbox;

    for (i = 0, cbox = eval("document." + cb_name + i);
         cbox;
         i++, cbox = eval("document." + cb_name + i))
    {
        if (cbox.checked)
        {
            all_entities[cbox.getAttribute("entity")][cbox.getAttribute("user")] = value;
            cbox.checked = false;
        }
    }

    self.location.reload();
}

function process_on_load_event()
{
    if (window.opener.filter_win_reloaded)
    {
        /* 
         * We were just loaded from node frame, so that 
         * frame does not need to be refreshed, just reset the variable.
         */
        window.opener.filter_win_reloaded = false;
    }
    else
    {
        /*
         * We've been just opened from the frame, 
         * or some filtering settings have been updated and we've just
         * reloaded ourselves.
         * In first case we do not need to reload frame, but we do it
         * just to simplify JS code.
         * In the second case we have to reload frame as some messages
         * have to be hiden or shown according to new filtering 
         * information.
         */
        window.opener.location.reload();
    }
    self.focus();
}

</script>

  </head>
  <body onLoad='javascript:process_on_load_event()'>

<script>
    nd_entities = window.opener.entities;
    all_entities = window.opener.top.entities;
    var enabled_msgs = "";
    var disabled_msgs = "";
    var i = 0;
    var j = 0;

    for (entity in nd_entities)
    {
        user_array = nd_entities[entity];
        for (user in user_array)
        {
            if (!all_entities[entity][user])
            {
                if (i == 0)
                {
                    disabled_msgs += 
"Logs from the following objects are hidden:<br>" +
"<table border='0' cellpadding='0' cellspacing='0' width='100%'>" +
"<form name='show_form'>" +
"<tr>" +
"  <td>" +
"      <table border='0' cellpadding='0' cellspacing='0' width='100%'>" +
"      <tr>" +
"        <td class='tdsubheading'>" +
"          <table border='0' cellpadding='0' cellspacing='0'>" +
"          <tr>" +
"            <td width='30' class='tdsubhead'>&nbsp;</td>" +
"            <td width='150' class='tdsubhead'>Entity Name</td>" +
"            <td width='150' class='tdsubhead'>User Name</td>" +
"          </tr>" +
"          </table>" +
"        </td>" +
"      </tr>" +
"      </table>" +
"      <img border='0' src='images/tr.gif' width='1' height='10'><br>";
                }
                
                disabled_msgs +=
"      <table border='0' cellpadding='0' cellspacing='0' width='100%'>" +
"      <tr>" +
"        <td class='" + ((i % 2 == 0) ? "tdlight" : "tddark") + "'>" +
"          <table border='0' cellpadding='0' cellspacing='0'>" +
"          <tr>" +
"            <td width='30' align='center'><input type='checkbox' entity='" + entity +"' user='" + user + "' name='chd" + i + "'></td>" +
"            <td width='150' class='entityname'>" + entity + "</td>" +
"            <td width='150' class='username'>" + user + "</td>" +
"          </tr>" +
"          </table>" +
"        </td>" +
"      </tr>" +
"      </table>";
                i++;
            }
            else
            {
                if (j == 0)
                {
                    enabled_msgs += 
"Logs from the following objects are shown:<br>" +
"<table border='0' cellpadding='0' cellspacing='0' width='100%'>" +
"<form name='hide_form'>" +
"<tr>" +
"  <td>" +
"      <table border='0' cellpadding='0' cellspacing='0' width='100%'>" +
"      <tr>" +
"        <td class='tdsubheading'>" +
"          <table border='0' cellpadding='0' cellspacing='0'>" +
"          <tr>" +
"            <td width='30' class='tdsubhead'>&nbsp;</td>" +
"            <td width='150' class='tdsubhead'>Entity Name</td>" +
"            <td width='150' class='tdsubhead'>User Name</td>" +
"          </tr>" +
"          </table>" +
"        </td>" +
"      </tr>" +
"      </table>" +
"      <img border='0' src='images/tr.gif' width='1' height='10'><br>";
                }

                enabled_msgs +=
"      <table border='0' cellpadding='0' cellspacing='0' width='100%'>" +
"      <tr>" +
"        <td class='" + ((j % 2 == 0) ? "tdlight" : "tddark") + "'>" +
"          <table border='0' cellpadding='0' cellspacing='0'>" +
"          <tr>" +
"            <td width='30' align='center'><input type='checkbox' entity='" + entity +"' user='" + user + "' name='che" + j + "'></td>" +
"            <td width='150' class='entityname'>" + entity + "</td>" +
"            <td width='150' class='username'>" + user + "</td>" +
"          </tr>" +
"          </table>" +
"        </td>" +
"      </tr>" +
"      </table>";
                j++;
            }
        }
    }

    if (i > 0)
    {
        disabled_msgs += 
"      <img border='0' src='images/tr.gif' width='1' height='10'><br>" +
"  </td>" +
"</tr>" +
"<tr>" + 
"  <td>" +
"      <input type='button' value='Show' onClick='javascript:logsUpdate(\"show_form.chd\", true)'>" +
"  </td>" +
"</tr>" +
"</form>" +
"</table>";
    }
    if (j > 0)
    {
        enabled_msgs += 
"      <img border='0' src='images/tr.gif' width='1' height='10'><br>" +
"  </td>" +
"</tr>" +
"<tr>" + 
"  <td>" +
"      <input type='button' value='Hide' onClick='javascript:logsUpdate(\"hide_form.che\", false)'>" +
"  </td>" +
"</tr>" +
"</form>" +
"</table>";
    }

    document.write(disabled_msgs + enabled_msgs);
</script>
    
</table>
</body>
</html>
