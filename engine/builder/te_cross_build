#! /bin/sh

# Test Environment
#
# Script for building of cross packages.
#
# Usage: builder_generate_symtbl "$(NM)" <out C file name> <list of TA objects> 
#
# List of TA object may contain libraryies as well.
#
# Copyright (C) 2004 Test Environment authors (see file AUTHORS in the 
# root directory of the distribution).
#
# Test Environment is free software; you can redistribute it and/or 
# modify it under the terms of the GNU General Public License as 
# published by the Free Software Foundation; either version 2 of 
# the License, or (at your option) any later version.
# 
# Test Environment is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, 
# MA  02111-1307  USA
#
# Author Elena A. Vengerova <Elena.Vengerova@oktetlabs.ru>
# 
# $Id: builder_generate_symtbl,v 1.1 2003/10/28 09:35:41 arybchik Exp $

. builder.conf.processed

PREFIX=$1
DUMMY=

for p in ${TE_BS_PLATFORMS} ; do
    PLATFORM=`echo $p | sed s/_/-/g`
    mkdir -p $TE_INSTALL/$PLATFORM
    if test $PLATFORM = $host ; then continue ; fi
    LIBS=`eval echo '$'${p}'_LIBS'`
    for package in $LIBS ; do
        PKGNAME=${p}_$package
        PKGSRC=`eval echo '$TE_BS_LIB_'${PKGNAME}'_SOURCES'`
        if test -z "$PKGSRC" ; then 
            PKGSRC=${TE_BASE}/lib/$package ; 
        fi
        ${TE_BASE}/engine/builder/te_configure_package LIB $package \
            ${p}_$package $PLATFORM $PKGSRC $PREFIX || exit 1
        cd lib/${p}_$package
        make install || exit 1
        cd ../..
    done
done

for package in $DUMMY $TE_BS_TA ; do
    PLATFORM=`eval echo '$TE_BS_TA_'${package}'_PLATFORM'` ;
    if test "$PLATFORM" = "$host" ; then continue ; fi ;
    PKGSRC=`eval echo '$TE_BS_TA_'${package}'_SOURCES'` ;
    if test -z "$PKGSRC" ; then 
        PKGSRC=${TE_BASE}/agents/$package ; 
    fi
    ${TE_BASE}/engine/builder/te_configure_package TA $package $package \
        $PLATFORM $PKGSRC $PREFIX || exit 1
    cd agents/$package
    make install || exit 1        
    cd ../..
done

exit 0
