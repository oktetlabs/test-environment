---

- comment: |
    Kernel modules control configuration model.

    Copyright (C) 2017-2020 OKTET Labs.

    Author: Dmitry Izbitsky <Dmitry.Izbitsky@oktetlabs.ru>

- register:

    - oid: "/agent/module"
      access: read_create
      type: none
      depends:
        - oid: "/agent/rsrc"
      d: |
         System module.
         Name: Name of the system module

    - oid: "/agent/module/loaded"
      access: read_write
      type: integer
      volatile: true
      d: |
         Is module loaded in the system
         Value: 1 means loaded

    - oid: "/agent/module/unload_holders"
      access: read_write
      type: integer
      d: |
         Toggle indicating whether an attempt to unload module holders
         is made before the module itself is unloaded
         Name:  none
         Value: 1 - try to unload holders, 0 - do not unload (default)

    - oid: "/agent/module/filename"
      access: read_write
      type: string
      volatile: true
      d: |
         Name of the file containing the module or 'unknown'.
         modinfo integration is not yet there.
         Value: path in the file system

    - oid: "/agent/module/filename/load_dependencies"
      access: read_write
      type: integer
      d: |
         A means to demand that dependencies be queried and
         resolved for the given module prior calling insmod.

         @note The internal implementation calls modinfo on
               the module file after changing /agent/module/loaded
               value to 1 and then calls modprobe for every
               dependency discovered. Then insmod is called.

         Name:  none
         Value: 0, 1

    - oid: "/agent/module/filename/fallback"
      access: read_write
      type: integer
      d: |
         Boolean node indicating whether to load module shipped with the
         currently running kernel if path specified in /agent/filename doesn't
         exist.
         Name:  none
         Value: 0, 1

    - oid: "/agent/module/parameter"
      access: read_create
      type: string
      depends:
        - oid: "/agent/module/loaded"
      d: |
         Parameter of a system module.
         Name: Name of the parameter
         Value: Value of the parameter
