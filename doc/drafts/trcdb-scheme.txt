/* Night testing results tracking database */

/* Table configurations describes all configurations involved in night testing
     name - Name of configuration
     board - board type used in configuration
     descr - configuration description
     reqs(?) - set of configuration specific requirements used to run/skip test iterations
     tags - set of configuration specific tags used for results comparison
 */
CREATE TABLE configurations (
    id       INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    name     VARCHAR(16) UNIQUE,
    board    VARCHAR(16),
    descr    VARCHAR(512),
    reqs     VARCHAR(128), -- WIFI_SPECIFIC, LANGROUPS_SPECIFIC, PLATFORM_WAN_ATM/PLATFORM_WAN_ETH,...
    tags     VARCHAR(128)
);

/* Table configurations describes all configurations involved in night testing
     name - Name of branch
     descr - branch description (kernel version,...)
     build - build timestamp
     reqs(?) - set of branch specific requirements
     tags - set of branch specific tags
 */
CREATE TABLE branches (
    id       INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    name     VARCHAR(16),
    descr    VARCHAR(128),
    build    TIMESTAMP,
    reqs     VARCHAR(128), -- !IGMPV3_SPECIFIC,...
    tags     VARCHAR(128)
);

/* Table scrips describes original test scripts without any parameters
     name - name of script
     path - full path of test script within test suite
     objective - test objective, cut from test script doxygen objective field
     description(?) - 
 */
CREATE TABLE scripts (
    id           INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    name         VARCHAR(32),
    path         VARCHAR(128),
    objective    VARCHAR(512)
);

/* Table iterations describes all available iterations for each test script, also contains all sessions with parameters
     script_id - index of test script in scripts table 
     name - name of iteration
     session_id - index of session in the same iterations table
     params - normalised params of the iteration
     subsystems - subsystems that should be tested by this certain iteration
 */
CREATE TABLE iterations (
    id           INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    script_id    INT REFERENCES scripts(id),
    name         VARCHAR(32),
    session      INT,
    params       VARCHAR(1024),
    subsystems   VARCHAR(128)
);

/* Table results stores all night testing results
     iter - index of iteration that was run
     configuration - configuration where the iteration was run
     branch - version of firmware that was tested
     start - start timestamp of iteration
     end - end timestamp of iteration
     tin - test iteration number (may differs for different configurations)
     result - testing result (PASSED/FAILED)
     verdict - resulted test verdict
 */
CREATE TABLE results (
    id                  INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    iter                INT REFERENCES iterations(id),
    configuraion        INT REFERENCES configuraions(id),
    branch              INT REFERENCES branches(id),
    start               TIMESTAMP,
    end                 TIMESTAMP,
    tin                 INT,
    result              BOOLEAN,
    verdict             VARCHAR(512)
);

/* Table expected results represents current trc.xml that contains all expected results for comparison
     iter - index of iteration in iterations table
     configuration - configuration to run the iteration on
     branch - version of firmware to run the iteration on
     tags - set of tags to match the iteration result
     result - expected result
     verdict - expected test verdict for this iteration
     bugs - set of keywords/bugs which this result corresponds to
 */
CREATE TABLE expected_results (
    id                  INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    iter                INT REFERENCES iterations(id),
    configuraion        INT REFERENCES configuraions(id),
    branch              INT REFERENCES branches(id),
    tags                VARCHAR(128),
    result              BOOLEAN,
    verdict             VARCHAR(512),
    bugs                VARCHAR(128)
);
